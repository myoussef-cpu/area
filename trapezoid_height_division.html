<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªÙ‚Ø³ÙŠÙ… Ù…Ø³Ø§Ø­Ø© Ø´Ø¨Ù‡ Ø§Ù„Ù…Ù†Ø­Ø±Ù Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icon.png">
  <meta name="theme-color" content="#3498db">
  <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #1c1e21;
            direction: rtl;
            transition: background-color 0.3s, color 0.3s;
        }

        .dark-mode body {
            background-color: #1c1c1e;
            color: #ffffff;
        }

        .container {
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .dark-mode .card {
            background: #2c2c2e;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        h3 {
            font-size: 1.1rem;
            margin-bottom: 16px;
            color: #007aff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .input-group {
            margin-bottom: 16px;
            text-align: right;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #8e8e93;
        }

        input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 1rem;
            background: #f8f9fa;
            box-sizing: border-box;
            transition: border-color 0.3s, background-color 0.3s;
        }

        .dark-mode input {
            background: #1c1c1e;
            border-color: #3a3a3c;
            color: white;
        }

        input:focus {
            border-color: #007aff;
            outline: none;
        }

        .result-card {
            margin-top: 20px;
            padding: 16px;
            background: #eef7ff;
            border-radius: 12px;
            border-right: 4px solid #007aff;
        }

        .dark-mode .result-card {
            background: #1c3d5a;
            border-right-color: #4dabff;
        }

        .section-item {
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 0.9rem;
            border: 1px solid #eee;
        }

        .dark-mode .section-item {
            background: #2c2c2e;
            border-color: #3a3a3c;
        }

        .save-btn {
            width: 100%;
            padding: 14px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body class="mobile-view">
    <div class="container">
        <div class="card">
            <h3><i class="fas fa-layer-group"></i> ØªÙ‚Ø³ÙŠÙ… Ø´Ø¨Ù‡ Ø§Ù„Ù…Ù†Ø­Ø±Ù</h3>
            
            <div class="input-grid">
                <div class="input-group">
                    <label>Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØµØºØ±Ù‰ (a):</label>
                    <input type="number" id="a" step="any" placeholder="0.00" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ (b):</label>
                    <input type="number" id="b" step="any" placeholder="0.00" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù…Ø§Ø¦Ù„ Ø§Ù„Ø£ÙˆÙ„ (L1):</label>
                    <input type="number" id="L1" step="any" placeholder="0.00" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù…Ø§Ø¦Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (L2):</label>
                    <input type="number" id="L2" step="any" placeholder="0.00" oninput="calculate()">
                </div>
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ø«Ø§Ù„: 5, 10, 15):</label>
                <input type="text" id="heights" placeholder="Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø©" oninput="calculate()">
            </div>

            <div id="results" class="hidden"></div>
            
            <button id="saveBtn" class="save-btn hidden" onclick="saveResult()">
                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            </button>
        </div>
    </div>

    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark-mode');
        }

        function calculate() {
            const a = parseFloat(document.getElementById("a").value);
            const b = parseFloat(document.getElementById("b").value);
            const L1 = parseFloat(document.getElementById("L1").value);
            const L2 = parseFloat(document.getElementById("L2").value);
            const heightsStr = document.getElementById("heights").value;
            const heights = heightsStr.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));

            const resultsDiv = document.getElementById("results");
            const saveBtn = document.getElementById("saveBtn");

            if (isNaN(a) || isNaN(b) || isNaN(L1) || isNaN(L2) || heights.length === 0) {
                resultsDiv.classList.add("hidden");
                saveBtn.classList.add("hidden");
                return;
            }

            const baseDifference = (b - a) / 2;
            const h1 = Math.sqrt(Math.max(0, L1 * L1 - baseDifference * baseDifference));
            const h2 = Math.sqrt(Math.max(0, L2 * L2 - baseDifference * baseDifference));
            const totalHeight = (h1 + h2) / 2;

            if (isNaN(totalHeight) || totalHeight <= 0) {
                resultsDiv.innerHTML = '<p style="color: red; text-align: center;">Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ØºÙŠØ± ØµØ­ÙŠØ­Ø© ÙŠØ§ Ù‡Ù†Ø¯Ø³Ø©</p>';
                resultsDiv.classList.remove("hidden");
                return;
            }

            const totalArea = ((a + b) / 2) * totalHeight;
            resultsDiv.classList.remove("hidden");
            saveBtn.classList.remove("hidden");
            
            let html = `
                <div class="result-card">
                    <strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙƒÙ„ÙŠØ©: ${totalArea.toFixed(2)} Ù…ØªØ±Â²</strong>
                </div>
                <h4 style="margin: 15px 0 10px;">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:</h4>
            `;

            let currentTopBase = a;
            let currentBottomBase = b;
            let remainingHeight = totalHeight;
            let totalUsedArea = 0;

            for (let i = 0; i < heights.length; i++) {
                const height = heights[i];
                if (height > remainingHeight) {
                    html += `<p style="color:orange; font-size:0.8rem;">Ø§Ù„Ù‚Ø³Ù… ${i+1} ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ!</p>`;
                    break;
                }

                const newBase = currentTopBase + ((currentBottomBase - currentTopBase) / remainingHeight) * height;
                const area = ((currentTopBase + newBase) / 2) * height;
                const conv = convertToFeddans(area);

                html += `
                    <div class="section-item">
                        <strong>Ø§Ù„Ù‚Ø³Ù… ${i + 1}:</strong> ${area.toFixed(2)} Ù…ØªØ±Â²<br>
                        <small>${conv.feddan} ÙØ¯Ø§Ù†ØŒ ${conv.qirat} Ù‚ÙŠØ±Ø§Ø·ØŒ ${conv.sahm} Ø³Ù‡Ù…</small><br>
                        <small>Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ù„ÙˆÙŠØ©: ${currentTopBase.toFixed(2)} | Ø³ÙÙ„ÙŠØ©: ${newBase.toFixed(2)}</small>
                    </div>
                `;

                currentTopBase = newBase;
                remainingHeight -= height;
                totalUsedArea += area;
            }

            if (remainingHeight > 0.01) {
                const remainingArea = totalArea - totalUsedArea;
                const conv = convertToFeddans(remainingArea);
                html += `
                    <div class="result-card" style="margin-top:15px; background: #fff3e0; border-right-color: #ff9800;">
                        <strong>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> ${remainingArea.toFixed(2)} Ù…ØªØ±Â²<br>
                        <small>Ø§Ø±ØªÙØ§Ø¹ Ù…ØªØ¨Ù‚ÙŠ: ${remainingHeight.toFixed(2)} Ù…ØªØ±</small>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
        }

        function convertToFeddans(m2) {
            const feddan = 4200.83;
            const qirat = 175.034;
            const sahm = 7.293;

            let remaining = m2;
            let f = Math.floor(remaining / feddan);
            remaining -= f * feddan;
            let q = Math.floor(remaining / qirat);
            remaining -= q * qirat;
            let s = remaining / sahm;

            return { feddan: f, qirat: q, sahm: s.toFixed(2) };
        }

        function saveResult() {
            const resultsDiv = document.getElementById("results");
            const data = {
                type: "ØªÙ‚Ø³ÙŠÙ… Ø´Ø¨Ù‡ Ù…Ù†Ø­Ø±Ù (Ø§Ø±ØªÙØ§Ø¹Ø§Øª)",
                result: "Ù†ØªØ§Ø¦Ø¬ ØªÙ‚Ø³ÙŠÙ… Ø´Ø¨Ù‡ Ù…Ù†Ø­Ø±Ù",
                details: resultsDiv.innerText
            };

            if (window.firebaseLogic && window.firebaseLogic.saveResult) {
                window.firebaseLogic.saveResult(data)
                    .then(() => alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ÙŠØ§ Ø±ÙŠØ³! ğŸ˜'))
                    .catch(() => alert('Ø§ØªØ­ÙØ¸Øª Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ø³ Ø¹Ø´Ø§Ù† ÙÙŠÙ‡ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©'));
            } else {
                let savedResults = JSON.parse(localStorage.getItem('savedResults') || '[]');
                data.timestamp = new Date().toISOString();
                savedResults.push(data);
                localStorage.setItem('savedResults', JSON.stringify(savedResults));
                alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙŠØ§ Ø±ÙŠØ³! ğŸ˜');
            }
        }
    </script>
</body>
</html>
