<title>حساب مساحة الرباعي الدائري</title>

<div class="calc-container">
    <div class="card">
        <div class="input-group">
            <label><i class="fas fa-arrows-alt-h"></i> الضلع الأول (a)</label>
            <input type="number" id="a" placeholder="أدخل الطول بالمتر" step="any" oninput="calculateArea()">
        </div>
        <div class="input-group">
            <label><i class="fas fa-arrows-alt-h"></i> الضلع الثاني (b)</label>
            <input type="number" id="b" placeholder="أدخل الطول بالمتر" step="any" oninput="calculateArea()">
        </div>
        <div class="input-group">
            <label><i class="fas fa-arrows-alt-v"></i> الضلع الثالث (L1)</label>
            <input type="number" id="L1" placeholder="أدخل الطول بالمتر" step="any" oninput="calculateArea()">
        </div>
        <div class="input-group">
            <label><i class="fas fa-arrows-alt-v"></i> الضلع الرابع (L2)</label>
            <input type="number" id="L2" placeholder="أدخل الطول بالمتر" step="any" oninput="calculateArea()">
        </div>
    </div>

    <div id="initialArea" class="result-card hidden">
        <!-- النتائج الأولية هتظهر هنا -->
    </div>

    <button class="btn-main" onclick="saveResult()" id="saveBtn" style="display: none; margin-top: 10px; background: #27ae60;">
        <i class="fas fa-save"></i> حفظ النتيجة
    </button>
</div>

<style>
    .calc-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding-bottom: 20px;
    }

    .input-group {
        margin-bottom: 15px;
        text-align: right;
    }

    .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-light);
    }

    .dark-mode .input-group label {
        color: var(--text-dark);
    }

    .input-group label i {
        color: var(--primary);
        margin-left: 5px;
    }

    .result-card {
        background: white;
        border-radius: 16px;
        padding: 20px;
        border-right: 5px solid var(--primary);
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        text-align: right;
    }

    .dark-mode .result-card {
        background: var(--card-dark);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .result-card h3 {
        margin: 0 0 10px;
        font-size: 1.1rem;
        color: var(--primary);
    }

    .result-card p {
        margin: 8px 0;
        font-size: 0.95rem;
        line-height: 1.5;
    }

    .result-card span {
        font-weight: 700;
        color: var(--primary);
    }

    .hidden { display: none; }
</style>

<script>
    function calculateArea() {
        const a = parseFloat(document.getElementById("a").value);
        const b = parseFloat(document.getElementById("b").value);
        const L1 = parseFloat(document.getElementById("L1").value);
        const L2 = parseFloat(document.getElementById("L2").value);

        const initialAreaDiv = document.getElementById("initialArea");
        const saveBtn = document.getElementById("saveBtn");

        if (isNaN(a) || isNaN(b) || isNaN(L1) || isNaN(L2) || a <= 0 || b <= 0 || L1 <= 0 || L2 <= 0) {
            initialAreaDiv.classList.add('hidden');
            saveBtn.style.display = 'none';
            return;
        }

        // حساب المساحة باستخدام صيغة براهماغوبتا
        const s = (a + b + L1 + L2) / 2;
        const area = Math.sqrt((s - a) * (s - b) * (s - L1) * (s - L2));

        if (isNaN(area)) {
            initialAreaDiv.innerHTML = `<p style="color: #e74c3c;">الأضلاع دي متنفعش تعمل رباعي دائري يا هندسة!</p>`;
            initialAreaDiv.classList.remove('hidden');
            saveBtn.style.display = 'none';
            return;
        }

        const areaConverted = convertToFeddans(area);
        const diagonals = calculateDiagonals(a, b, L1, L2);

        initialAreaDiv.innerHTML = `
            <h3>النتيجة:</h3>
            <p>المساحة الكلية: <span>${area.toFixed(2)}</span> متر²</p>
            <p>بالوحدات: <span>${areaConverted.feddan}</span> فدان، <span>${areaConverted.qirat}</span> قيراط، <span>${areaConverted.sahm}</span> سهم</p>
            <p>القطر الأول: <span>${diagonals.diagonal1.toFixed(2)}</span> متر</p>
            <p>القطر الثاني: <span>${diagonals.diagonal2.toFixed(2)}</span> متر</p>
        `;
        initialAreaDiv.classList.remove('hidden');
        saveBtn.style.display = 'block';
    }

    function calculateDiagonals(a, b, L1, L2) {
        const diagonal1 = Math.sqrt(((a * L1 + b * L2) * (a * L2 + b * L1)) / (a * b + L1 * L2));
        const diagonal2 = Math.sqrt(((a * L1 + b * L2) * (a * b + L1 * L2)) / (a * L2 + b * L1));
        return { diagonal1, diagonal2 };
    }

    function saveResult() {
        const a = document.getElementById("a").value;
        const b = document.getElementById("b").value;
        const L1 = document.getElementById("L1").value;
        const L2 = document.getElementById("L2").value;
        const resultText = document.getElementById("initialArea").innerText;
        
        const data = {
            type: "رباعي دائري",
            input: `أضلاع: ${a}, ${b}, ${L1}, ${L2}`,
            result: resultText,
            details: resultText
        };

        if (window.firebaseLogic && window.firebaseLogic.saveResult) {
            window.firebaseLogic.saveResult(data)
                .then(() => alert('تم حفظ النتيجة بنجاح يا ريس ✅'))
                .catch(() => alert('حصل مشكلة في السحابة، بس حفظناها محلياً'));
        } else {
            let savedResults = JSON.parse(localStorage.getItem('savedResults') || '[]');
            data.timestamp = new Date().toISOString();
            savedResults.push(data);
            localStorage.setItem('savedResults', JSON.stringify(savedResults));
            alert('تم الحفظ محلياً (Firebase غير متصل) ✅');
        }
    }
</script>