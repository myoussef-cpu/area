<title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</title>
<div class="settings-container">
    <div class="section-title">Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ø®ØµÙŠ</div>
    <div class="settings-list">
        <div class="setting-item liquid-glass" id="profile-btn">
            <div class="setting-icon-box" style="--bg: #e3f2fd; --color: #1e88e5;">
                <i class="fas fa-user-circle"></i>
            </div>
            <div class="setting-details">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                <p id="user-email">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
            <div class="setting-arrow">
                <i class="fas fa-chevron-left"></i>
            </div>
        </div>
    </div>

    <div class="section-title">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
    <div class="settings-list">
        <div class="setting-item liquid-glass" onclick="toggleDarkMode()">
            <div class="setting-icon-box" style="--bg: #f3e5f5; --color: #8e24aa;">
                <i class="fas fa-moon"></i>
            </div>
            <div class="setting-details">
                <h3>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</h3>
                <p>ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ ÙˆØ§Ù„Ù…Ø¸Ù„Ù…</p>
            </div>
            <div class="custom-toggle" id="dark-mode-toggle">
                <div class="toggle-thumb">
                    <i id="toggle-icon" class="fas fa-sun"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="section-title">Ø­ÙˆÙ„</div>
    <div class="settings-list">
        <div class="setting-item liquid-glass">
            <div class="setting-icon-box" style="--bg: #fff3e0; --color: #fb8c00;">
                <i class="fas fa-code"></i>
            </div>
            <div class="setting-details">
                <h3>Ø§Ù„Ù…Ø·ÙˆØ±</h3>
                <p>ÙŠÙˆØ³Ù Ø¹ÙŠØ¯ Ø§Ù„Ø²ØºØ¨ÙŠ</p>
            </div>
        </div>
        <div class="setting-item liquid-glass">
            <div class="setting-icon-box" style="--bg: #f1f8e9; --color: #7cb342;">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="setting-details">
                <h3>Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
                <p>Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.0.0</p>
            </div>
        </div>
    </div>
</div>

<style>
    .settings-container {
        padding: 10px 5px;
    }

    .settings-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 25px;
    }

    .setting-item {
        background: var(--card-light);
        backdrop-filter: blur(25px) saturate(180%);
        -webkit-backdrop-filter: blur(25px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.4);
        padding: 16px;
        border-radius: 22px;
        display: flex;
        align-items: center;
        gap: 15px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        position: relative;
        overflow: hidden;
    }

    .dark-mode .setting-item {
        background: var(--card-dark);
        border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .setting-item:active {
        transform: scale(0.97);
        background: rgba(255, 255, 255, 0.4);
    }

    .dark-mode .setting-item:active {
        background: rgba(255, 255, 255, 0.05);
    }

    .setting-icon-box {
        width: 45px;
        height: 45px;
        background: var(--bg);
        color: var(--color);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .setting-details {
        flex: 1;
        text-align: right;
    }

    .setting-details h3 {
        margin: 0;
        font-size: 1rem;
        font-weight: 700;
        color: var(--text-light);
    }

    .dark-mode .setting-details h3 {
        color: var(--text-dark);
    }

    .setting-details p {
        margin: 3px 0 0;
        font-size: 0.8rem;
        color: #8e8e93;
    }

    .setting-arrow, .setting-toggle {
        color: #c7c7cc;
        font-size: 0.9rem;
    }

    /* Ø§Ù„ØªÙˆØ¬ÙŠÙ„ Ø§Ù„Ù…Ø®ØµØµ - Custom Liquid Toggle */
    .custom-toggle {
        width: 50px;
        height: 28px;
        background: rgba(120, 120, 128, 0.16);
        border-radius: 14px;
        position: relative;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
    }

    .dark-mode .custom-toggle {
        background: rgba(255, 255, 255, 0.1);
    }

    .custom-toggle.active {
        background: var(--primary);
    }

    .toggle-thumb {
        width: 24px;
        height: 24px;
        background: white;
        border-radius: 50%;
        position: absolute;
        top: 1px;
        left: 2px;
        transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
    }

    .custom-toggle.active .toggle-thumb {
        left: calc(100% - 26px);
        transform: rotate(360deg);
    }

    .toggle-thumb i {
        color: #8e8e93;
        transition: all 0.3s;
    }

    .custom-toggle.active .toggle-thumb i {
        color: var(--primary);
    }
</style>

<script type="module">
    import { onUserChange } from './firebase-logic.js';

    const profileBtn = document.getElementById('profile-btn');
    const userEmail = document.getElementById('user-email');

    profileBtn.addEventListener('click', () => {
        window.location.href = 'profile.html';
    });

    onUserChange((user) => {
        if (user) {
            userEmail.textContent = user.email || 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„';
            if (user.photoURL) {
                const iconBox = profileBtn.querySelector('.setting-icon-box');
                iconBox.innerHTML = `<img src="${user.photoURL}" style="width:100%; height:100%; border-radius:14px; object-fit:cover;">`;
                iconBox.style.background = 'transparent';
            }
        } else {
            userEmail.textContent = 'Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
        }
    });

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„ØªÙˆØ¬ÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
    function updateToggleState() {
        const isDarkMode = document.body.classList.contains('dark-mode');
        const toggleContainer = document.getElementById('dark-mode-toggle');
        const toggleIcon = document.getElementById('toggle-icon');
        
        console.log("ğŸ”„ Updating toggle state. Dark mode:", isDarkMode);
        
        if (toggleContainer) {
            if (isDarkMode) {
                toggleContainer.classList.add('active');
                if (toggleIcon) {
                    toggleIcon.className = 'fas fa-moon';
                    toggleIcon.style.color = '#fff';
                }
            } else {
                toggleContainer.classList.remove('active');
                if (toggleIcon) {
                    toggleIcon.className = 'fas fa-sun';
                    toggleIcon.style.color = '#f1c40f';
                }
            }
        }
    }

    // Ø±Ø¨Ø· Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ¬ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù€ item ÙƒÙ„Ù‡
    const settingItem = document.querySelector('.setting-item[onclick="toggleDarkMode()"]');
    if (settingItem) {
        // Ø¨Ù†Ù„ØºÙŠ Ø§Ù„Ù€ onclick Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆÙ†Ø­Ø· ÙˆØ§Ø­Ø¯ Ø¬Ø¯ÙŠØ¯ Ø£Ø´Ø·Ø±
        settingItem.onclick = null; 
        settingItem.addEventListener('click', (e) => {
            console.log("ğŸ”˜ Toggle clicked!");
            if (window.toggleDarkMode) {
                window.toggleDarkMode();
                // Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¨ÙŠØ­ØµÙ„ Ù„ÙˆØ­Ø¯Ù‡ Ø¹Ø´Ø§Ù† ÙÙŠÙ‡ MutationObserver Ø¨ÙŠØ³Ù…Ø¹ Ø§Ù„ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù€ body
            }
        });
    }

    // Ù†Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ù€ body Ø¹Ø´Ø§Ù† Ù†Ø­Ø¯Ø« Ø§Ù„Ø²Ø±Ø§Ø± ÙÙˆØ±Ø§Ù‹ Ù„Ùˆ Ø§ØªØºÙŠØ± Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø±
    if (window.darkModeObserver) window.darkModeObserver.disconnect();
    window.darkModeObserver = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === 'class') {
                updateToggleState();
            }
        });
    });
    window.darkModeObserver.observe(document.body, { attributes: true });

    // ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø¯Ø¦ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©
    setTimeout(updateToggleState, 50);
</script>
