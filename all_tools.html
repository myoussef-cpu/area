<title>كل الأدوات الهندسية</title>

<div class="all-tools-container">
    <!-- بار البحث -->
    <div class="search-section card">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="toolSearch" placeholder="ابحث عن أداة (مثلاً: خرسانة، مثلث...)" oninput="filterTools()">
        </div>
        <div class="category-filters" id="categoryFilters">
            <!-- التصنيفات هتظهر هنا -->
        </div>
    </div>

    <!-- شبكة الأدوات -->
    <div id="toolsGrid" class="tools-grid">
        <!-- الأدوات هتظهر هنا ديناميكياً -->
    </div>
</div>

<style>
    .all-tools-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .search-section {
        padding: 15px !important;
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .search-box {
        background: rgba(0,0,0,0.05);
        border-radius: 15px;
        padding: 12px 15px;
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
    }

    .dark-mode .search-box {
        background: rgba(255,255,255,0.05);
    }

    .search-box input {
        border: none;
        background: none;
        outline: none;
        width: 100%;
        font-family: 'Tajawal', sans-serif;
        font-size: 1rem;
        color: var(--text-light);
    }

    .dark-mode .search-box input {
        color: var(--text-dark);
    }

    .category-filters {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding-bottom: 5px;
        scrollbar-width: none; /* Firefox */
    }

    .category-filters::-webkit-scrollbar {
        display: none; /* Chrome/Safari */
    }

    .cat-chip {
        padding: 8px 16px;
        border-radius: 20px;
        background: var(--bg-light);
        border: 1px solid var(--border-light);
        font-size: 0.85rem;
        font-weight: 700;
        white-space: nowrap;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--text-light);
    }

    .dark-mode .cat-chip {
        background: var(--card-dark);
        border-color: var(--border-dark);
        color: var(--text-dark);
    }

    .cat-chip.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .tools-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
    }

    .tool-card {
        background: var(--card-light);
        border: 1px solid var(--border-light);
        border-radius: 22px;
        padding: 20px 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 12px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    }

    .dark-mode .tool-card {
        background: var(--card-dark);
        border-color: var(--border-dark);
    }

    .tool-card:active {
        transform: scale(0.95);
    }

    .tool-card-icon {
        width: 50px;
        height: 50px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        background: var(--primary);
        color: white;
        box-shadow: 0 5px 15px rgba(0, 122, 255, 0.2);
    }

    .tool-card h4 {
        margin: 0;
        font-size: 0.9rem;
        font-weight: 800;
        color: var(--text-light);
    }

    .dark-mode .tool-card h4 {
        color: var(--text-dark);
    }

    .tool-card p {
        margin: 0;
        font-size: 0.75rem;
        color: #8e8e93;
        line-height: 1.2;
    }
</style>

<script type="module">
    import { TOOLS, TOOL_CATEGORIES } from './tools-data.js';

    let currentCategory = 'all';
    let searchQuery = '';

    function init() {
        renderFilters();
        renderTools();
    }

    function renderFilters() {
        const container = document.getElementById('categoryFilters');
        let html = `<div class="cat-chip active" onclick="window.setCategory('all')">الكل</div>`;
        
        Object.values(TOOL_CATEGORIES).forEach(cat => {
            html += `<div class="cat-chip" data-id="${cat.id}" onclick="window.setCategory('${cat.id}')">${cat.name}</div>`;
        });
        
        container.innerHTML = html;
    }

    window.setCategory = function(catId) {
        currentCategory = catId;
        document.querySelectorAll('.cat-chip').forEach(chip => {
            chip.classList.toggle('active', (chip.dataset.id === catId) || (catId === 'all' && !chip.dataset.id));
        });
        renderTools();
    }

    window.filterTools = function() {
        searchQuery = document.getElementById('toolSearch').value.toLowerCase();
        renderTools();
    }

    function renderTools() {
        const grid = document.getElementById('toolsGrid');
        const filtered = TOOLS.filter(tool => {
            const matchesCat = currentCategory === 'all' || tool.cat === currentCategory;
            const matchesSearch = tool.name.toLowerCase().includes(searchQuery) || 
                                tool.desc.toLowerCase().includes(searchQuery);
            return matchesCat && matchesSearch;
        });

        grid.innerHTML = filtered.map(tool => `
            <div class="tool-card" onclick="openTool('${tool.id}', ${tool.legacy || false})">
                <div class="tool-card-icon">
                    <i class="${tool.icon}"></i>
                </div>
                <h4>${tool.name}</h4>
                <p>${tool.desc}</p>
            </div>
        `).join('');
    }

    window.openTool = function(id, isLegacy) {
        if (isLegacy) {
            window.navigateTo(id);
        } else {
            window.navigateTo('smart_tool', { toolId: id });
        }
    }

    init();
</script>
